<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Challenge 1: Silent Button</title>
    <link rel="stylesheet" href="styles.css">
    <script src="mock-api.js"></script>
</head>

<body>
    <div class="challenge-container">
        <a href="index.html" class="back-link">‚Üê Back to Challenges</a>

        <div class="challenge-header">
            <div class="challenge-number">Challenge 1</div>
            <h1>Silent Button</h1>
            <p class="subtitle">The checkout button doesn't respond</p>
        </div>

        <div class="challenge-content">
            <h2>üõí Shopping Cart</h2>

            <div class="cart-item">
                <div class="cart-item-info">
                    <h3>üéß Wireless Headphones</h3>
                    <p>Quantity: 5</p>
                </div>
                <div class="cart-item-price">$299.99</div>
            </div>

            <div class="cart-item">
                <div class="cart-item-info">
                    <h3>üì± Phone Case</h3>
                    <p>Quantity: 2</p>
                </div>
                <div class="cart-item-price">$19.99</div>
            </div>

            <div class="cart-total">
                <h3>Total: $339.97</h3>
            </div>

            <div style="margin-top: 2rem; text-align: center;">
                <button id="placeOrderBtn" class="btn btn-success">
                    Place Order
                </button>
            </div>

            <div id="errorMessage" style="margin-top: 1rem; color: var(--danger); text-align: center; display: none;">
                <!-- Error message should appear here but doesn't -->
            </div>
        </div>
    </div>

    <script>
        document.getElementById('placeOrderBtn').addEventListener('click', async function () {
            const button = this;

            // Visual feedback - button works
            button.style.opacity = '0.7';
            setTimeout(() => button.style.opacity = '1', 200);

            const orderData = {
                items: [
                    { product: 'Wireless Headphones', quantity: 5, price: 299.99 },
                    { product: 'Phone Case', quantity: 2, price: 19.99 }
                ],
                total: 339.97
            };

            try {
                // Make REAL HTTP request - intercepted by Service Worker
                // This WILL show in Network tab!
                const response = await fetch('/api/v1/order', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(orderData)
                });

                if (response.ok) {
                    alert('Order placed successfully!');
                } else {
                    // Response is not 2xx (will be 422)
                    const errorData = await response.json();

                    // BUG: Frontend doesn't show the error to user!
                    // The error is caught but errorMessage div stays hidden
                    console.error('Order failed:', errorData);

                    // This is what SHOULD happen:
                    // const errorDiv = document.getElementById('errorMessage');
                    // errorDiv.textContent = errorData.message;
                    // errorDiv.style.display = 'block';
                }

            } catch (error) {
                console.error('Network error:', error);
            }
        });
    </script>
</body>

</html>